<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <!-- favicon -->
    <link rel="icon" type="image/svg+xml" href="/img/icons/svg/check-double-solid_dark.svg">

    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1">-->
    <meta name="description" content="CheckDev - пробные собеседования в IT.">
    <title>Сообщения</title>

    <!-- Required meta tags -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- fontawesome-free-6.3.0-web -->
    <link th:href="@{/webjars/font-awesome/6.3.0/css/all.min.css}" rel="stylesheet">
    <!-- Bootstrap 5.3.2 -->
    <link th:href="@{/webjars/bootstrap/5.3.2/css/bootstrap.min.css}" rel="stylesheet">
    <script th:src="@{/webjars/bootstrap/5.3.2/js/bootstrap.min.js}"></script>
    <!-- Popper.js 2.11.7 -->
    <script th:src="@{/webjars/popper.js/2.11.7/umd/popper.js}"></script>
    <!-- Jquery.js 3.7.1 -->
    <script th:src="@{/webjars/jquery/3.7.1/jquery.min.js}"></script>
    <!-- Summernote 0.8.10 -->
    <link th:href="@{/webjars/summernote/0.8.10/summernote-lite.css}" rel="stylesheet">
    <script th:src="@{/webjars/summernote/0.8.10/summernote-lite.js}"></script>
    <script th:src="@{/webjars/summernote/0.8.10/lang/summernote-ru-RU.js}"></script>

    <script th:inline="javascript">
        function showDialog(element) {
            var itemId = element.getAttribute('data-item-id');
            $('#delete_dialog').modal('show');
            $('#delete_dialog').attr('data-item-id', itemId);
            $('#confirmDeleteButton').on('click', function() {
                deleteItem(itemId);
            });
        }

        function messagesOnclick(element) {
           var itemId = element.getAttribute('data-item-id');
           setReadItem(itemId);
        }

        function deleteItem(itemId) {
            $.ajax({
                    type: 'DELETE',
                    url: '/messages_rest/delete/' + itemId,
                    success: function (result) {
                        location.reload();
                    }
                });
        }

        function setReadItem(itemId) {
            $.ajax({
                    type: 'PUT',
                    url: '/messages_rest/setRead/' + itemId
                });
        }

        function setReadAll(element) {
            var userId = element.getAttribute('user-id');
            $.ajax({
                     type: 'PUT',
                     url: '/messages_rest/setReadAll/' + userId,
                     success: function () {
                        location.reload();
                     }
                   });
        }





    </script>

</head>
<body>
<div th:insert="fragments/header :: header"></div>
<div class="container">
    <span th:if="${listIsEmpty}">
        <div class="alert alert-info" role="alert">
            У вас нет новых сообщений.
        </div>
    </span>
    <div th:if="${listIsNotEmpty}">
        <button class="btn btn-primary" style="float: right;" th:user-id="${userId}" onclick="setReadAll(this)">
            Прочитать все сообщения
        </button>
    </div>
    <table class="table table-hover">
        <thead>
        <tr>
            <th scope="col">Сообщение</th>
            <th scope="col">Дата</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="message : ${innerMessages}">
            <td>
            <span>
                <a class="text-decoration-none text-dark"
                   th:href="@{|/interview/${message.interviewId}|}"
                   th:data-item-id="${message.id}" onclick="messagesOnclick(this)">
                    <span th:text="${message.text}"></span>
                </a>
            </span>
            </td>
            <td>
                <span th:text="${#dates.format(message.created, 'dd-MM-yyyy HH:mm:ss')}"></span>
            </td>
            <td>
                <i class="fas fa-times"
                   th:data-item-id="${message.id}"
                   onclick="showDialog(this)">
                </i>
                <div class="modal" id="delete_dialog" tabindex="-1" role="dialog" data-item-id="">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Удаление сообщения</h5>
                                <button type="button" class="btn-close"
                                        data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <p>Уверены что хотите навсегда удалить это сообщение?</p>
                            </div>
                            <div class="modal-footer">
                                <button id="confirmDeleteButton" type="submit"
                                        class="btn btn-danger btn-sm">Удалить
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
    <div th:if="${listIsNotEmpty}">
        <button class="btn btn-primary" style="float: right;" th:user-id="${userId}" onclick="setReadAll(this)">
            Прочитать все сообщения
        </button>
    </div>
</div>
<div th:insert="fragments/footer :: footer"></div>
</body>
</html>