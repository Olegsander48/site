<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html" lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- favicon -->
    <link rel="icon" type="image/svg+xml" href="/img/icons/svg/check-double-solid_dark.svg">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1">-->
    <meta name="description" content="CheckDev - пробные собеседования в IT.">
    <title>Главная</title>

    <!-- Required meta tags -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- fontawesome-free-6.3.0-web -->
    <link th:href="@{/webjars/font-awesome/6.3.0/css/all.min.css}" rel="stylesheet">
    <!-- Bootstrap 5.3.2 -->
    <link th:href="@{/webjars/bootstrap/5.3.2/css/bootstrap.min.css}" rel="stylesheet">
    <script th:src="@{/webjars/bootstrap/5.3.2/js/bootstrap.min.js}"></script>
    <!-- Popper.js 2.11.7 -->
    <script th:src="@{/webjars/popper.js/2.11.7/umd/popper.js}"></script>
    <!-- Jquery.js 3.7.1 -->
    <script th:src="@{/webjars/jquery/3.7.1/jquery.min.js}"></script>
    <!-- Summernote 0.8.10 -->
    <link th:href="@{/webjars/summernote/0.8.10/summernote-lite.css}" rel="stylesheet">
    <script th:src="@{/webjars/summernote/0.8.10/summernote-lite.js}"></script>
    <script th:src="@{/webjars/summernote/0.8.10/lang/summernote-ru-RU.js}"></script>
    <script>
        function rowClicked(value) {
            location.href = "/topics/" + value + "";
        }

        function showDialog(element) {
            var itemId = element.getAttribute('data-item-id');
            $('#delete_dialog').modal('show');
            $('#delete_dialog').attr('data-item-id', itemId);
            $('#confirmDeleteButton').on('click', function() {
                deleteItem(itemId);
            });
        }

        function deleteItem(itemId) {
            $.ajax({
                 type: 'DELETE',
                 url: '/statistic/delete/' + itemId,
                 success: function () {
                        location.reload();
                     }
            });
        }
    </script>

</head>
<body>
<div th:insert="fragments/header :: header"></div>
<div class="container" th:if="${categories != null}">
    <div class="row">
        <div class="cell">
            <div class="alert alert-info" role="alert">
                <span class="fw-bold">CheckDev</span> - пробные собеседования в IT.
                В проекте CheckDev Вы можете потренироваться перед реальными собеседованиями. <br/>
                Выберите интересующую <a th:href="@{/categories/}" class="alert-link">категорию</a>.
                Выберите нужную тему и создайте пробное собеседование.
                Попробуйте себя в роли кандидата и интервьюера.
            </div>
        </div>
    </div>
    <div class="row pb-3">
        <div class="cell">
            <div class="card">
                <div class="card-header" style="display: inline-flex; align-items: center;">
                    <span>
                        <h5 class="card-header">Аналитика рынка от hh.ru</h5>
                    </span>
                    <span style="font-size: smaller; margin-left: 10px;"
                          th:text="'обновлено: ' + ${vacancyStatisticLastUpdateDate}"></span>
                    <span style="font-size: smaller; margin-left: 10px;"
                          th:text=" 'обновится: ' + ${vacancyStatisticNextUpdateDate}"></span>
                </div>
                <div class="card-body">
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th scope="col">Ключевые слова</th>
                            <th scope="col">Вакансий</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="statistic: ${vacancyStatistic}">
                            <td>
                                <div class="d-flex align-items-center">
                                    <h5 th:text="${statistic.name}"></h5>
                                    <a th:if="${canManage}"
                                       class="text-decoration-none text-dark"
                                       th:href="@{|/statistic/editForm/${statistic.id}/${statistic.name}|}">
                                        <i class="fas fa-pencil-alt ms-2"></i>
                                    </a>
                                </div>
                            </td>
                            <td>
                                <span class="fw-bold" th:text="${statistic.count}"></span>
                                <span th:if="${statistic.countChanges > 0}" class="mr-3"
                                      th:text="'+' + ${statistic.countChanges}"
                                      style="color: green">
                                </span>
                                <span th:if="${statistic.countChanges < 0}" class="mr-3"
                                      th:text="${statistic.countChanges}"
                                      style="color: red">
                                </span>
                            </td>
                            <td th:if="${canManage}">
                                <i class="fas fa-times"
                                   th:data-item-id="${statistic.id}"
                                   onclick="showDialog(this)">
                                </i>
                            </td>
                        </tr>
                        </tbody>
                    </table>

                    <div class="modal" id="delete_dialog" tabindex="-1" role="dialog" data-item-id="">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Удаление ключа</h5>
                                    <button type="button" class="btn-close"
                                            data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <p>Уверены что хотите удалить этот пункт?</p>
                                </div>
                                <div class="modal-footer">
                                    <button id="confirmDeleteButton" type="submit"
                                            class="btn btn-danger btn-sm">Удалить
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div th:if="${canManage}" class="row ms-3">
                        <div class="col-md-6">
                            <div>
                                <a th:href="@{/statistic/createForm}" class="btn btn-primary btn-sm btn-block">
                                    Добавить
                                </a>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div>
                                <a th:href="@{/indexRenew}" class="btn btn-primary btn-sm btn-block">
                                    Обновить
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="row pb-3">
        <div class="cell">
            <div class="card">
                <h5 class="card-header">Новые собеседования</h5>
                <div class="card-body">
                    <table class="table">
                        <tbody class="table-hover">
                        <tr th:each="interview: ${new_interviews}" style="cursor: pointer;">
                            <td>
                                <div>
                                    <a class="fw-bold text-dark text-decoration-none"
                                       th:href="@{|/interview/${interview.id}|}">
                                        <h5 th:if="${topicsLiteMap.containsKey(interview.topicId)}"
                                            th:text="${topicsLiteMap.get(interview.topicId).categoryName + ' / ' + topicsLiteMap.get(interview.topicId).name}"></h5>
                                    </a>
                                </div>
                                <div class="pb-2">
                                    <span class="mb-2 text-muted">
                                        <span th:insert="fragments/statusInterview::status"></span>
                                        <i class="far fa-clock pl-3"></i>
                                        <span th:text="${#strings.substring(interview.createDate, 0, 10)}"></span>
                                        <i class="far fa-user pl-3"></i>
                                        <span th:text="${authService.findById(interview.submitterId).username}"></span>
                                        <i class="fa fa-comments pl-3" aria-hidden="true"></i>
                                        <span>Откликов:</span>
                                        <span th:text="${interview.countWishers}"></span>
                                        <i class="fa fa-calendar-check pl-3"></i>
                                        <span>Удобное время:</span>
                                        <span th:text="${interview.approximateDate}"></span>
                                    </span>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="row pb-3">
        <div class="cell">
            <div class="card">
                <h5 class="card-header">Популярные категории</h5>
                <div class="card-body">
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th scope="col">Категория</th>
                            <th scope="col">Собеседования</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="category: ${categories}" style="cursor: pointer;"
                            th:onclick="'javascript:rowClicked(\'' + ${category.id} + '\');'">
                            <td>
                                <div>
                                    <a class="fw-bold text-dark text-decoration-none"
                                       th:href="@{|/topics/${category.id}|}">
                                        <h5 th:text="${category.name}"></h5>
                                    </a>
                                </div>
                                <small class="mb-2 text-muted">
                                    <span><i class="fas fa-eye pr-3"></i> : </span>
                                    <span class="fw-bold" th:text="${category.total}"></span>
                                    <span class="mr-3">Тем : </span>
                                    <span class="fw-bold" th:text="${category.topicsSize}"></span>
                                </small>
                            </td>
                            <td>
                                <span class="badge bg-success"
                                      th:text="'Новых:' + ${category.countInterview}"></span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<div th:insert="fragments/footer :: footer"></div>
</body>
</html>
