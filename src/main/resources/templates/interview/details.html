<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- favicon -->
    <link rel="icon" type="image/svg+xml" href="/img/icons/svg/check-double-solid_dark.svg">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1">-->
    <meta name="description" content="CheckDev - пробные собеседования в IT.">
    <title
            th:text="${'Собеседование на тему '
                        + topicLiteDTO.categoryName
                        + '\'
                        + topicLiteDTO.name
                        + '. '
                        + interview.author}">
        Собеседование на тему ИМЯ_КАТЕГОРИИ\ИМЯ_ТЕМУ. ИМЯ_АВТОРА</title>

    <!-- Required meta tags -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- fontawesome-free-6.3.0-web -->
    <link th:href="@{/webjars/font-awesome/6.3.0/css/all.min.css}" rel="stylesheet">
    <!-- Bootstrap 5.3.2 -->
    <link th:href="@{/webjars/bootstrap/5.3.2/css/bootstrap.min.css}" rel="stylesheet">
    <script th:src="@{/webjars/bootstrap/5.3.2/js/bootstrap.min.js}"></script>
    <!-- Popper.js 2.11.7 -->
    <script th:src="@{/webjars/popper.js/2.11.7/umd/popper.js}"></script>
    <!-- Jquery.js 3.7.1 -->
    <script th:src="@{/webjars/jquery/3.7.1/jquery.min.js}"></script>
    <!-- Summernote 0.8.10 -->
    <link th:href="@{/webjars/summernote/0.8.10/summernote-lite.css}" rel="stylesheet">
    <script th:src="@{/webjars/summernote/0.8.10/summernote-lite.js}"></script>
    <script th:src="@{/webjars/summernote/0.8.10/lang/summernote-ru-RU.js}"></script>

    <style>
        .form-group .mock {
            visibility: hidden;
        }

        .form-group .message {
            transform: translateY(20px);
            transition: opacity 0.4s, visibility 0.4s, transform 0.4s;
            opacity: 0;
            visibility: hidden;
        }

        .form-group:hover .message {
            background: #11EE66;
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }








    </style>

</head>
<body>
<div th:insert="fragments/header :: header"></div>
<div class="container">
    <span th:if="${STATUS_IS_COMPLETED_ID != interview.statusId}">
    <div class="alert alert-info" role="alert">

        <span th:if="${userInfo==null}">
            <span th:if="${STATUS_IS_NEW_ID!=interview.statusId}">
            Если Вы не Автор и не одобренный участник, то у Вас уже нет доступа к данному собеседованию
            </span>
            <span th:if="${STATUS_IS_NEW_ID==interview.statusId}">
            Нажмите кнопку "Откликнуться", чтобы принять участие в собеседовании
            </span>
        </span>
        <span th:if="${userInfo != null}">
            <span th:if="${isAuthor}">
                <span th:if="${STATUS_IS_NEW_ID==interview.statusId}">
                    Ожидайте откликов других участников. Когда на Ваше собеседование откликнутся, Вы получите уведомление. Далее Вы можете одобрить одного из участников и с ним провести очное собеседование.
                </span>
                <span th:if="${STATUS_IS_CANCELED_ID==interview.statusId}">
                    Вы отменили это собеседование. Теперь его можете видеть только вы.
                </span>
                <span th:if="${STATUS_IN_PROGRESS_ID==interview.statusId}">
                    Проведите очное собеседование. Контактные данные находятся в таблице участники - контакты. После собеседования оставьте отзыв-рекомендации участнику собеседования.
                </span>
                <span th:if="${STATUS_IS_FEEDBACK_ID==interview.statusId}">
                    <span th:if="${!feedbackMap.containsKey(interview.submitterId)}">
                        Оставьте отзыв участнику.
                    </span>
                    <span th:if="${feedbackMap.containsKey(interview.submitterId)}">
                        Ожидайте, когда участник оставит Вам отзыв.
                    </span>
                </span>
            </span>
            <span th:if="${!isAuthor}">
                <span th:if="${!isWisher}">
                    <span th:if="${STATUS_IS_NEW_ID==interview.statusId}">
                        Нажмите кнопку "Откликнуться", чтобы принять участие в собеседовании
                    </span>
                    <span th:if="${STATUS_IS_NEW_ID!=interview.statusId}">
                        Если Вы не Автор и не одобренный участник, то у Вас уже нет доступа к данному собеседованию
                    </span>
                </span>
                <span th:if="${isWisher}">
                    <span th:if="${isUserDismissed}">
                        <span th:if="${STATUS_IN_PROGRESS_ID==interview.statusId}">
                            Проведите очное собеседование. Контактные данные находятся в таблице участники - контакты. После собеседования оставьте отзыв-рекомендации участнику собеседования.
                        </span>
                        <span th:if="${STATUS_IS_FEEDBACK_ID==interview.statusId && !feedbackMap.containsKey(userInfo.id)}">
                            Оставьте отзыв автору.
                        </span>
                        <span th:if="${STATUS_IS_FEEDBACK_ID==interview.statusId && feedbackMap.containsKey(userInfo.id)}">
                            Ожидайте, когда автор собеседования оставит Вам отзыв.
                        </span>
                    </span>
                    <span th:if="${!isUserDismissed}">
                        <span th:if="${STATUS_IS_NEW_ID!=interview.statusId}">
                            Если Вы не Автор и не одобренный участник, то у Вас уже нет доступа к данному собеседованию
                        </span>
                        <span th:if="${STATUS_IS_NEW_ID==interview.statusId}">
                            Ожидайте одобрения автора на Ваше участие в собеседовании.
                        </span>
                    </span>
                </span>
            </span>
        </span>
    </div>
    </span>
    <div class="card">
        <span th:if="${STATUS_IS_NEW_ID==interview.statusId || isAuthor || isWisher && isUserDismissed}">
            <div class="card-header">
                <div>
                <span class="fw-bold" th:text="${topicLiteDTO.categoryName + ' / ' + topicLiteDTO.name}"></span>
                <span th:if="${userInfo != null}">
                    <a th:if="${isAuthor and !isDismissed}"
                       class="text-decoration-none text-dark"
                       th:href="@{|/interview/edit/${interview.id}|}">
                        <i class="fas fa-pencil-alt pl-3"></i>
                    </a>
                </span>
            </div>
            <span class="text-muted d-flex align-items-center">
                <span th:insert="fragments/statusInterview::status"></span>
                <i class="far fa-clock"></i>
                <span class="me-2" th:text="${#strings.substring(interview.createDate, 0, 10)}"></span>
                <i class="far fa-user"></i>
                <span class="me-2" th:text="${authService.findById(interview.submitterId).username}"></span>
                <i class="fa fa-calendar-check"></i>
                <span class="me-2"
                      th:text="${'Дата и время проведения собеседования: ' + interview.approximateDate}"></span>
                <!--/*Кнопки отменить интервью. Доступна если статус IS_NEW или IN_PROGRESS*/-->
        <div class="ms-auto"
             th:if="${userInfo != null && (STATUS_IN_PROGRESS_ID==interview.statusId || STATUS_IS_NEW_ID==interview.statusId)}">
<!--            <form th:action="@{|/interview/cancel/${interview.id}|}" method="get">-->


            <form th:action="@{|/interview/cancel/reason/${interview.id}|}" method="get">
                <div th:if="${isAuthor && !feedbackMap.containsKey(interview.submitterId)}">
                    <button type="submit"
                            class="btn btn-danger align-middle d-inline-block">Отменить собеседование</button>
                </div>
            </form>
        </div>
            </span>
            </div>
            <div class="card-body">
                <table class="table">
                    <thead>
                    <tr>
                        <th scope="col">Участники собеседования</th>
                        <th scope="col">Контакт</th>
                        <th scope="col">Роль</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>
                            <span th:text="${interview.author}"></span>
                        </td>
                        <td>
                            <span th:if="${isAuthor or isUserDismissed}" th:text="${interview.contactBy}"></span>
                        </td>
                        <td>
                            <span th:if="${interview.mode == 1}">Буду проводить собеседование (задавать вопросы)</span>
                            <span th:if="${interview.mode == 2}">Буду проходить собеседование (отвечать на вопросы)</span>
                        </td>
                    </tr>
                    <tr th:each="wisher : ${wishersDetail}" th:if="${wisher.approve}">
                        <td>
                            <span th:text="${wisher.username}"></span>
                        </td>
                        <td>
                            <span th:if="${isAuthor or isUserDismissed}" th:text="${wisher.contactBy}"></span>
                        </td>
                        <td>
                            <span th:if="${interview.mode == 2}">Буду проводить собеседование (задавать вопросы)</span>
                            <span th:if="${interview.mode == 1}">Буду проходить собеседование (отвечать на вопросы)</span>
                        </td>
                </tr>
                <tr th:if="${feedbackMap.containsKey(interview.submitterId)}">
                    <td>
                        <span class="text-dark">Отзыв участнику</span>
                    </td>
                    <td></td>
                    <td>
                        <span th:each="feedback : ${feedbackMap.get(interview.submitterId)}">
                            <pre th:utext="${feedback.textFeedback}"/>
                        </span>
                    </td>
                </tr>
                <tr th:if="${feedbackMap.containsKey(wisher.userId)}" th:each="wisher : ${wishersDetail}">
                    <td>
                        <span class="text-dark">Отзыв автору</span>
                    </td>
                    <td></td>
                    <td th:if="${wisher.approve}">
                        <span th:each="feedback : ${feedbackMap.get(wisher.userId)}">
                            <pre th:utext="${feedback.textFeedback}"/>
                        </span>
                    </td>
                </tr>
                </tbody>
            </table>
                <!--/*Кнопки оставить отзыв. Доступна если статус IN_PROGRESS*/-->
            <div th:if="${userInfo != null && (STATUS_IN_PROGRESS_ID==interview.statusId || STATUS_IS_FEEDBACK_ID==interview.statusId)}">
                <!--Кнопка оставляет отзыв АВТОР собеседования. Доступна если isAuthor=true-->
                <form th:action="@{|/interview/feedback/${interview.id}|}" method="get">
                    <div th:if="${isAuthor && !feedbackMap.containsKey(interview.submitterId)}">
                        <button type="submit" class="btn btn-primary">Оставить отзыв участнику</button>
                    </div>
                    <!--Кнопка оставляет отзыв УЧАСТНИК собеседования. Доступна если isWisher=true-->
                    <div th:if="${isUserDismissed && !feedbackMap.containsKey(userInfo.id)}">
                        <button type="submit" class="btn btn-primary">Оставить отзыв автору</button>
                    </div>
                </form>
            </div>
            <div>
                <!--/* Отображение списка участников собеседования */-->
                <div th:if="${!isDismissed and !wishersDetail.isEmpty()}">
                    <table class="table">
                        <thead>
                        <tr>
                            <th scope="col">Откликнулись</th>
                            <th th:if="${isAuthor}" scope="col">Действия</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="wisher : ${wishersDetail}" th:if="${!wisher.approve}">
                                <td>
                                    <a th:href="@{|/profiles/${wisher.userId}|}">
                                        <span class="fw-bold" th:text="${wisher.username}"></span>
                                    </a>
                                </td>
                            <td>
                                <form th:if="${userInfo != null && isAuthor && !isDismissed && isAuthor}"
                                      th:action="@{/wisher/dismissed}"
                                      method="post">
                                    <input type="hidden" th:id="interviewId" th:name="interviewId"
                                           th:value="${wisher.interviewId}">
                                    <input type="hidden" th:id="wisherId" th:name="wisherId"
                                           th:value="${wisher.id}">
                                    <input type="hidden" th:id="wisherUserId" th:name="wisherUserId"
                                           th:value="${wisher.userId}">
                                    <input type="hidden" th:id="interviewTitle" th:name="interviewTitle"
                                           th:value="${interview.title}">
                                    <input type="hidden" th:id="contactBy" th:name="contactBy"
                                           th:value="${interview.contactBy}">
                                    <button type="submit" class="btn btn-primary">Одобрить</button>
                                </form>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <a th:if="${!isWisher && (!isAuthor || userInfo == null) && !isDismissed}"
                   class="btn btn-primary"
                   th:disabled="${isWisher || isAuthor}"
                   th:href="${userInfo != null}
                    ? (${isWisher} ? @{#} : @{|/interview/${interview.id}/participate|})
                    : @{|/login?redirectUri=/interview/${interview.id}/participate&interviewId=${interview.id}|}">
                    Откликнуться
                </a>
            </div>
            <p class="fw-bold" th:if="${interview.additional != ''}">Дополнительное описание</p>
            <pre class="mt-3" th:utext="${interview.additional}"></pre>
            <p class="fw-bold">Описание</p>
            <pre class="mt-3" th:utext="${topicLiteDTO.text}"></pre>



            </div>
        </span>
    </div>
</div>

<div th:insert="fragments/footer :: footer"></div>
</body>
</html>